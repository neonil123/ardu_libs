<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>HopeRF: HRFReliableDatagram Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">HopeRF
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">HRFReliableDatagram Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="HRFReliableDatagram" --><!-- doxytag: inherits="HRFDatagram" -->
<p>Class for sending addressed, acknowledged, retransmitted datagrams.  
 <a href="classHRFReliableDatagram.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="HRFReliableDatagram_8h_source.html">HRFReliableDatagram.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for HRFReliableDatagram:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classHRFReliableDatagram.png" usemap="#HRFReliableDatagram_map" alt=""/>
  <map id="HRFReliableDatagram_map" name="HRFReliableDatagram_map">
<area href="classHRFDatagram.html" title="Class for addressed, unreliable messages." alt="HRFDatagram" shape="rect" coords="0,56,136,80"/>
<area href="classHRFMessage.html" title="Basic message class for HopeRF data transceivers." alt="HRFMessage" shape="rect" coords="0,0,136,24"/>
</map>
 </div></div>

<p><a href="classHRFReliableDatagram-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHRFReliableDatagram.html#a4d2bfa0ffa6675ad99fdb5b805a6cf43">HRFReliableDatagram</a> (HardwareSerial *serial=&amp;Serial, uint8_t thisAddress=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHRFReliableDatagram.html#a5a4e12751e9ef8f910afee993d6dc106">setTimeout</a> (long timeout)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHRFReliableDatagram.html#afd586fb52837e784011ccd50d45922d4">setRetries</a> (uint8_t retries)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHRFReliableDatagram.html#a72c930aea867a5ec0570c5ce10dbcb46">sendtoWait</a> (uint8_t address, uint8_t *buf, uint8_t len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHRFReliableDatagram.html#a963f0dfc59aece24f248fd348984f473">recvfromAck</a> (uint8_t *buf, uint8_t *len, uint8_t *from=NULL, uint8_t *to=NULL)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Class for sending addressed, acknowledged, retransmitted datagrams. </p>
<p>Extends <a class="el" href="classHRFDatagram.html" title="Class for addressed, unreliable messages.">HRFDatagram</a> to define addressed, reliable datagrams with acknowledgement and retransmission. Based on <a class="el" href="classHRFDatagram.html" title="Class for addressed, unreliable messages.">HRFDatagram</a>, adds flags and sequence numbers. <a class="el" href="classHRFReliableDatagram.html" title="Class for sending addressed, acknowledged, retransmitted datagrams.">HRFReliableDatagram</a> is reliable in the sense that messages are acknowledged, and unacknowledged messages are retransmitted until acknowledged or the retries are exhausted. When addressed messages are collected by the application (recvfromAck), an acknowledgement is automatically sent. When addressed messages are sent (by sendtoWait), it will wait for an ack, and retransmit after timeout until an ack is received or retries are exhausted ReliableDatagrams have format LEN DEST SRC FLAG/SQN payload FCS-LO FCS-HI Low 7 bits of FLAG/SQN is the sequence number. Most significant bit is the ACK flag.</p>
<p>Part of the Arduino HopeRF library for operating with HopeRF HM-TR transceivers (see <a href="http://www.hoperf.com">http://www.hoperf.com</a>) </p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4d2bfa0ffa6675ad99fdb5b805a6cf43"></a><!-- doxytag: member="HRFReliableDatagram::HRFReliableDatagram" ref="a4d2bfa0ffa6675ad99fdb5b805a6cf43" args="(HardwareSerial *serial=&amp;Serial, uint8_t thisAddress=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HRFReliableDatagram::HRFReliableDatagram </td>
          <td>(</td>
          <td class="paramtype">HardwareSerial *&#160;</td>
          <td class="paramname"><em>serial</em> = <code>&amp;Serial</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>thisAddress</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">serial</td><td>The instance of HardwareSerial to use for IO. Defaults to &amp;Serial, </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thisAddress</td><td>The address to assign to this node. Defaults to 0 </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a963f0dfc59aece24f248fd348984f473"></a><!-- doxytag: member="HRFReliableDatagram::recvfromAck" ref="a963f0dfc59aece24f248fd348984f473" args="(uint8_t *buf, uint8_t *len, uint8_t *from=NULL, uint8_t *to=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t HRFReliableDatagram::recvfromAck </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>from</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>to</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If there is a valid message available for this node, send an acknowledgement to the SRC address (blocking until this is complete), then copy the message to buf and return true else return false. If a message is copied, *len is set to the length.. If from is not NULL, the SRC address is placed in *from. If to is not NULL, the DEST address is placed in *to. This is the preferred function for getting messages addressed to this node. If the message is not a broadcast, acknowledge to the sender before returning. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>Location to copy the received message </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>Available space in buf. Set to the actual number of octets copied. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">from</td><td>If present and not NULL, the referenced uint8_t will be set to the SRC address </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">to</td><td>If present and not NULL, the referenced uint8_t will be set to the DEST address </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="classHRFDatagram.html#a79cd59f8d1c39301bdc0c1b69120a4a1">HRFDatagram::recvfrom()</a>, and <a class="el" href="classHRFDatagram.html#aaedca44a35ddd9bbe739327dec4ac9fa">HRFDatagram::sendto()</a>.</p>

</div>
</div>
<a class="anchor" id="a72c930aea867a5ec0570c5ce10dbcb46"></a><!-- doxytag: member="HRFReliableDatagram::sendtoWait" ref="a72c930aea867a5ec0570c5ce10dbcb46" args="(uint8_t address, uint8_t *buf, uint8_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t HRFReliableDatagram::sendtoWait </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send the message and waits for an ack. Returns true if an acknowledgement is received. Synchronous: any message other than the desired ACK received while waiting is discarded. Blocks until an ACK is received or all retries are exhausted (ie up to retries*timeout milliseconds). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">address</td><td>The address to send the message to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>Pointer to the binary message to send </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>Number of octets to send </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if the message was transmitted and an acknowledgement is received. </dd>
<dd>
false if the message is too long (&gt;HRF_MAX_DATAGRAM_PAYLOAD). </dd></dl>

<p>References <a class="el" href="classHRFDatagram.html#a6157c61f42714d59c5b286f7fb9fd871">HRFDatagram::_thisAddress</a>, <a class="el" href="classHRFDatagram.html#a79cd59f8d1c39301bdc0c1b69120a4a1">HRFDatagram::recvfrom()</a>, and <a class="el" href="classHRFDatagram.html#aaedca44a35ddd9bbe739327dec4ac9fa">HRFDatagram::sendto()</a>.</p>

</div>
</div>
<a class="anchor" id="afd586fb52837e784011ccd50d45922d4"></a><!-- doxytag: member="HRFReliableDatagram::setRetries" ref="afd586fb52837e784011ccd50d45922d4" args="(uint8_t retries)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HRFReliableDatagram::setRetries </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>retries</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets the max number of retries. Defaults to 3. If set to 0, the message will only be sent once. sendtoWait will give up if there is no ack received after all transmissions time out. param[in] retries The maximum number a retries. </p>

</div>
</div>
<a class="anchor" id="a5a4e12751e9ef8f910afee993d6dc106"></a><!-- doxytag: member="HRFReliableDatagram::setTimeout" ref="a5a4e12751e9ef8f910afee993d6dc106" args="(long timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HRFReliableDatagram::setTimeout </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets the retransmit timeout. If sendtoWait is waiting for an ack longer than this time (in milliseconds), it will retransmit the message. Defaults to 1000ms. The timeout is measured from the beginning of transmission of the message. It must be longer than the transmit time of the request plus the transmit time of the acknowledgement (6 octets) plus the latency of the receiver. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">timeout</td><td>The new timeout period in milliseconds </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="HRFReliableDatagram_8h_source.html">HRFReliableDatagram.h</a></li>
<li>HRFReliableDatagram.cpp</li>
</ul>
</div>


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
